---
title: "Mental Health"
output: html_document
date: "2026-01-21"
---

```{r}
# Load necessary packages
library(tidyverse)
library(ggplot2)
library(reshape2)  # for data transformation
library(dplyr)
```
```{r}
# Mental disorders NSW
years <- 2017:2022
data <- data.frame(
  Year = years,
  `Dementia & Organic` = c(20376, 17042, 17443, 19572, 21740, 18087),
  `Mood Disorders` = c(347902, 282943, 307838, 321787, 318999, 259397),
  `Anxiety & Stress` = c(148081, 170410, 197990, 212723, 216109, 188543)
)

# Convert data to long format
df_long <- data %>%
  pivot_longer(-Year, names_to = "Category", values_to = "Count")

# Stacked Area Chart
ggplot(df_long, aes(x = Year, y = Count, fill = Category)) +
  geom_area(alpha = 0.8 , position = "stack") +
  scale_fill_brewer(palette = "Set3") +
  theme_minimal() +
  labs(
    title = "Mental Health Diagnoses Over Time in NSW",
    x = "Year",
    y = "Number of Cases",
    fill = "Category"
  )
```
```{r}
#Heatmap for mental health data in WA
# Data frame
df <- data.frame(
  Factor = c(
    "Neurocognitive Disorders", "Mood Disorders", "Anxiety & Stress Disorders"
  ),
  `2017` = c(3109, 41390, 48400),
  `2018` = c(8045, 108253, 85380),
  `2019` = c(7739, 103180, 89979),
  `2020` = c(8569, 110639, 99595),
  `2021` = c(8068, 108202, 100641),
  `2022` = c(5857, 83692, 91885),
  check.names = FALSE
)

# Convert to long format
df_long <- df %>%
  pivot_longer(cols = -Factor, names_to = "Year", values_to = "Count")

# Heatmap
ggplot(df_long, aes(x = Year, y = Factor, fill = Count)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "#f0f9e8", high = "#084081") +
  labs(
    title = "Heatmap of Mental Health Disorder Factors in WA",
    x = "Year",
    y = "Mental Disorder",
    fill = "Count"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid = element_blank()
  )
```

```{r}

#Heat map for Northern Territory
# ---- Data ----
df <- tribble(
  ~Category, ~`2017`, ~`2018`, ~`2019`, ~`2020`, ~`2021`, ~`2022`,
  "Organic Mental Disorders", 608, 831, 718, 657, 749, 688,
  "Mood (Affective) Disorders", 10833, 11953, 12480, 12087, 11906, 10803,
  "Anxiety and Stress-Related Disorders", 7485, 8316, 9144, 9917, 9804, 8434
)

# Convert to long format
df_long <- df %>%
  pivot_longer(cols = -Category, names_to = "Year", values_to = "Count")

# ---- Heatmap ----
ggplot(df_long, aes(x = Year, y = Category, fill = Count)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "#f1eef6", high = "#54278f") +
  labs(
    title = "Heatmap of Mental Disorder Categories in NT",
    x = "Year",
    y = "Category",
    fill = "Count"
  ) +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
# Data
total_suicides <- 50733
heat_related <- 264
other_suicides <- total_suicides - heat_related

# Scale for plotting
scale <- 50
total_dots <- ceiling(total_suicides / scale)
heat_dots <- ceiling(heat_related / scale)
other_dots <- total_dots - heat_dots

# Calculate grid size
grid_size <- ceiling(sqrt(total_dots))

# Create grid
x <- rep(1:grid_size, each = grid_size)
y <- rep(1:grid_size, times = grid_size)

# Create type vector
type <- c(rep("Heat-related", heat_dots),
          rep("Other suicides", other_dots))

# Trim excess points to match total_dots
x <- x[1:total_dots]
y <- y[1:total_dots]
type <- type[1:total_dots]

# Combine into data frame
dots <- data.frame(x = x, y = y, type = type)

# Plot
ggplot(dots, aes(x = x, y = y, color = type)) +
  geom_point(shape = 16, size = 3) +
  scale_color_manual(values = c("Heat-related" = "red", "Other suicides" = "grey70")) +
  labs(
    title = "Suicides Attributable to Climate Change-Induced Heat",
    subtitle = paste0("Heat-related suicides: ", heat_related, " (0.5%) of ", total_suicides),
    color = ""
  ) +
  theme_void() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    legend.position = "bottom"
  )
```

```{r}
# smooth seasonal curve
month <- seq(1, 12, length.out = 200)
logRR <- 0.05 * cos((month - 1) / 12 * 2 * pi)  # smooth seasonal shape
se <- 0.02 + 0.005 * cos((month - 4) / 12 * 2 * pi)  # varying uncertainty

df <- data.frame(
  month = month,
  logRR = logRR,
  lower = logRR - se,
  upper = logRR + se
)

# Define Spring boundaries (example: month 9–11)
spring_start <- 9
spring_end   <- 11

ggplot(df, aes(x = month, y = logRR)) +
  geom_ribbon(aes(ymin = lower, ymax = upper), fill = "skyblue") +
  geom_line(size = 1) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_vline(xintercept = spring_start, linetype = "dashed") +
  geom_vline(xintercept = spring_end, linetype = "dashed") +
  annotate("text", x = (spring_start + spring_end)/2, y = 0.02,
           label = "Spring", size = 5) +
  labs(x = "Month", y = "log Relative Risk") +
  coord_cartesian(ylim = c(-0.1, 0.1)) +
  theme_bw() +
  theme(
    text = element_text(size = 14),
    panel.grid = element_blank()
  )

```

```{r}
# Create the data frame
data <- tibble(
  GCCSA = c("Sydney", "Rest of NSW", "Melbourne", "Rest of VIC", "Brisbane", "Rest of QLD",
            "Adelaide", "Rest of SA", "Perth", "Rest of WA", "Hobart", "Rest of TAS",
            "Darwin", "Rest of NT", "Canberra"),
  Female = c(4.23, 4.69, 4.60, 4.77, 5.09, 6.14, 5.70, 4.89, 5.81, 6.74, 8.00, 6.14, 6.30, 10.76, 4.29),
  Male = c(12.61, 19.09, 13.10, 19.59, 17.33, 22.20, 18.47, 20.98, 17.23, 23.58, 19.32, 24.72, 23.97, 40.41, 14.30),
  Persons = c(8.36, 11.78, 8.77, 12.05, 11.11, 14.09, 11.95, 12.99, 11.47, 15.44, 13.49, 15.28, 15.58, 25.77, 9.22)
)

# Transform to long format for ggplot
data_long <- data %>%
  pivot_longer(cols = c(Female, Male, Persons), names_to = "Gender", values_to = "SuicideRate")

# Plot suicide death rates by region
ggplot(data_long, aes(x = GCCSA, y = SuicideRate, fill = Gender)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Suicide Death Rates by Region and Gender (2000-2019)",
       x = "Region (GCCSA)",
       y = "Suicide Death Rate (per 100,000)",
       fill = "Gender") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Create data frame
data <- data.frame(
  AgeGroup = rep(c("0-29", "30-54", "55+"), 2),
  Sex = rep(c("Male", "Female"), each = 3),
  Estimate = c(-117, 198, 264, -5, 12, 71),
  LowerCI = c(-128, 189, 257, -5, 12, 69),
  UpperCI = c(-106, 208, 271, -4, 13, 73),
  Pvalue = c(0.0559, 0.3156, 0.0325, 0.936, 0.8751, 0.1906)
)

# Add significance label
data <- data %>%
  mutate(Significant = ifelse(Pvalue < 0.05, "*", ""))

# Plot
ggplot(data, aes(x = AgeGroup, y = Estimate, fill = Sex)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), 
                position = position_dodge(width = 0.8), width = 0.2) +
  geom_text(aes(label = Significant, y = ifelse(Estimate > 0, UpperCI + 5, LowerCI - 5)),
            position = position_dodge(width = 0.8), size = 5) +
  labs(title = "Suicide Deaths Attributable to \n Temperature Heat Anomalies in Australia (2000–2019)",
       y = "Estimated Deaths (95% CI)",
       x = "Age Group") +
  scale_fill_manual(values = c("steelblue", "tomato")) +
  theme_minimal(base_size = 14)
```


```{r}
# Create a data frame for the meta-analysis results
meta_data <- data.frame(
  Analysis = c(
    "Mean monthly temperature (incidence)",
    "Mean daily temperature (incidence)",
    "Mean monthly temperature (risk ratio)"
  ),
  EffectSize = c(1.5, 1.7, 1.01),  # % change for first two, RR for third
  LowerCI = c(0.8, 0.3, 1.00),
  UpperCI = c(2.2, 3.0, 1.01),
  SampleSize = c("n=1,563,109", "n=113,523", "n=111,794"),
  Studies = c("7 effects from 3 studies", "5 effects from 5 studies", "6 effects from 3 studies")
)

# Optional: create a label combining sample size and studies
meta_data$Label <- paste0(meta_data$SampleSize, "; ", meta_data$Studies)

# Reverse factor levels so first row appears at top
meta_data$Analysis <- factor(meta_data$Analysis, levels = rev(meta_data$Analysis))

# Plot forest plot
ggplot(meta_data, aes(x = EffectSize, y = Analysis)) +
  geom_point(size = 4, color = "red") +
  geom_errorbarh(aes(xmin = LowerCI, xmax = UpperCI), height = 0.3, color = "black") +
  geom_vline(xintercept = ifelse(meta_data$EffectSize[3] < 2, 1, 0), linetype = "dashed") + # reference line for RR=1
  labs(
    title = "Effect of Temperature Increases on Suicide Outcomes",
    x = "Effect Size (% increase or RR)",
    y = "",
    caption = "Error bars = 95% CI"
  ) +
  geom_text(aes(label = Label, x = UpperCI + 0.05), hjust = 0, size = 3) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
    axis.text.y = element_text(size = 11),
    plot.caption = element_text(size = 10)
  ) +
  xlim(min(meta_data$LowerCI)-0.5, max(meta_data$UpperCI)+0.5)  # add space for labels

```
```{r}
#Relative risk plot
# Data for the heatwave analysis
heatwave_data <- data.frame(
  Exposure = c("Non-heatwave", "Heatwave"),
  RR = c(1, 1.097),  # baseline RR = 1, heatwave RR = 1 + 9.7%
  LowerCI = c(1, 1.076),  # lower CI for heatwave
  UpperCI = c(1, 1.119)   # upper CI for heatwave
)

# Plot Relative Risk
ggplot(heatwave_data, aes(x = Exposure, y = RR)) +
  geom_point(size = 5, color = "red") +
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.2, color = "black") +
  geom_hline(yintercept = 1, linetype = "dashed", color = "blue") +  # reference line
  labs(
    title = "Relative Risk of Suicide During Heatwave Periods",
    y = "Relative Risk (95% CI)",
    x = ""
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
    axis.text = element_text(size = 12)
  )

```

```{r}
# Data
data <- data.frame(
  Category = c("Displacement", "Mental Health Outcome"),
  Yes = c(22, 37),
  No = c(81-22, 81-37)
)

# Convert to long format
data_long <- reshape2::melt(data, id.vars = "Category", variable.name = "Status", value.name = "Count")

# Plot
ggplot(data_long, aes(x = Category, y = Count, fill = Status)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("Yes" = "red", "No" = "grey70")) +
  labs(title = "Impact of Flood on Respondents",
       y = "Number of Respondents",
       x = "",
       fill = "") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

#-- Pictogram (Dot / Icon Array)
total <- 81
displaced <- 22
mh_affected <- 37

# Create dots data
dots <- data.frame(
  x = rep(1:ceiling(sqrt(total)), each = ceiling(sqrt(total))),
  y = rep(1:ceiling(sqrt(total)), times = ceiling(sqrt(total))),
  Status = c(
    rep("Displaced", displaced),
    rep("Mental Health", mh_affected),
    rep("None", total - displaced - mh_affected)
  )
)

# Trim excess dots
dots <- dots[1:total, ]

# Plot pictogram
ggplot(dots, aes(x = x, y = y, color = Status)) +
  geom_point(shape = 16, size = 3) +
  scale_color_manual(values = c("Displaced" = "red", "Mental Health" = "orange", "None" = "grey70")) +
  labs(title = "Flood Impact on Respondents (n=81)",
       color = "") +
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        legend.position = "bottom")
```

